
<authentication>
  - We are using a library called better-auth to handle authentication.
  - You can only configure authentication in the project by calling the `setup-authentication` tool.
    - The tool will install the dependencies and configure the project to use better-auth.
    - The tool will configure the authentication tables in the database.
    - The tool will configure basic email/password auth.
  - You can use the `auth` instance in the `src/lib/auth/index.ts` file on the server.
  - You can use the `auth` instance in the `src/lib/auth/react.ts` file on the client.
  - You should update the `src/lib/auth/index.ts` file to what the user wants to do.
  - You MUST NOT use next.js middleware to handle authentication. Instead, you should check the session in routes.
  - All sign in, sign up, sign out, etc. MUST be handled using the client instance on client components.

  <configuring_better_auth>
    /src/lib/auth/index.ts
    ```typescript
    import { db } from "@/server/db";
    import { betterAuth } from "better-auth";
    import { drizzleAdapter } from "better-auth/adapters/drizzle";
    import { nextCookies } from "better-auth/next-js";
    import { oAuthProxy } from "better-auth/plugins";
    import { Resend } from "resend";

    const resend = new Resend(process.env.RESEND_API_KEY);

    export const auth = betterAuth({
      database: drizzleAdapter(db, {
        provider: "pg",
        usePlural: true,
      }),
      emailAndPassword: {
        enabled: true,
        autoSignIn: true,
        requireEmailVerification: true,
      },
      plugins: [nextCookies()],
    });

    export type Session = typeof auth.$Infer.Session;
    ```
  </configuring_better_auth>

  <examples_using_better_auth_on_client>
    All the functions are asynchronous and they can take fetchOptions as an optional option.
    Here are the options that you can use:
    - onResponse: () => void
    - onRequest: () => void
    - onError: (ctx: { error: Error }) => void
    - onSuccess: () => void

    <sign_in_on_client>
      ```typescriptreact
      "use client";

      import { auth } from "@/lib/auth/react";

      // Sign in
      await auth.signIn.email({
        email: data.email,
        password: data.password,
        fetchOptions: {
          onResponse: () => {
            // Do something when the response is received
          },
          onRequest: () => {
            // Do something when the request is sent
          },
          onError: (ctx) => {
            // Do something when the request fails
          },
          onSuccess: () => {
            // Do something when the request is successful
          },
        },
      });
      ```
    </sign_in_on_client>

    <sign_up_on_client>
      ```typescriptreact
      await auth.signUp.email({
        name: data.name,
        email: data.email,
        password: data.password,
        fetchOptions: {
          // Any options for the request
        },
      });
      ```
    </sign_up_on_client>

    <sign_in_with_social_provider_on_client>
      ```typescriptreact
      function SignInWithSocialProvider() {
        return (
          <button onClick={async () => {
            await auth.signIn.social({
              provider: "google", // The social provider to use
              callbackUrl: "/", // The url to redirect to after the social provider login
              fetchOptions: { // Any options for the request },
            });
          }}>
            Sign in with [PROVIDER]
          </button>
        )
      }
      ```
    </sign_in_with_social_provider_on_client>

    <sign_out_on_client>
      // Sign out

      await auth.signOut();
      ```
    </sign_out_on_client>

    <get_session_on_client>
      // Get the session on the client

    const { data, isPending, error } = auth.useSession();
    const { user, session } = data;

    // Here are all the other methods that you can use:

    // Forgot password
    await auth.forgotPassword({
      email: data.email,
      redirectUrl: "/auth/reset-password", // The url to redirect to after the forgot password request
      fetchOptions: {
        // Any options for the request
      },
    });

    // Reset password
    await auth.resetPassword({
      newPassword: data.password,
      fetchOptions: {
        // Any options for the request
      },
    });

    // Update user
    await auth.updateUser({
      name: data.name,
      fetchOptions: {
        // Any options for the request
      },
    });

    // Change password
    await auth.changePassword({
      newPassword: "newPassword123",
      currentPassword: "currentPassword123",
      revokeOtherSessions: true, // revoke all other sessions the user is signed into
      fetchOptions: {
        // Any options for the request
      },
    });

    // Change email
    await auth.changeEmail({
      newEmail: "new-email@email.com",
      callbackURL: "/dashboard", //to redirect after verification
      fetchOptions: {
        // Any options for the request
      },
    });

    // Delete user
    await auth.deleteUser({
      fetchOptions: {
        // Any options for the request
      },
    });
      ```
  </examples_using_better_auth_on_client>
</authentication>
